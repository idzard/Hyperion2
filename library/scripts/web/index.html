<html>
    <head>
        <link rel="stylesheet" href="controller/controller.css">
        <style>
            .monitor {
                position: fixed;
                right:16px;
                bottom: 16px;
                width: 640;
                height: 480;
                resize:both;
                border: 1px solid #444;
                z-index: 100;
            }
        </style>
        </link>
        <title>Controller - Hyperion</title>
        <script type="module">
            import { ControllerApp } from "./controller/controller.js"
            import { html, render } from './common/preact-standalone.js'

            render(html`<${ControllerApp}/>`, document.getElementById('controller'));

            const onBuildIdChange = () =>
            {
                window.location.reload();
            }
            window.onBuildIdChange=onBuildIdChange

            const createIframe = (url, scene) => {
                const iframe = document.createElement("iframe");
                iframe.src = url
                iframe.className = "monitor"
                document.body.appendChild(iframe)
                iframe.contentWindow.scene = scene
                iframe.contentWindow.onBuildIdChange = onBuildIdChange
            }

            fetch("./monitor2d/mapping.json").then(i=>i.json()).then(scene2d => {if (scene2d.length) createIframe("./monitor2d/", scene2d); });
            fetch("./monitor/mapping.json"  ).then(i=>i.json()).then(scene3d => {if (scene3d.length) createIframe("./monitor/", scene3d); });

        </script>
    </head>
    <body>        
        <div id="controller"></div>
    </body>
</html>